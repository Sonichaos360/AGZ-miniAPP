<div id="chatcontent">
</div>
<input type="hidden" name="LastIdChat" value="0" />
<input type="hidden" name="Nombre" value="" />

<script>
    $(document).ready(function(){

        $("input[name='Nombre']").val(localStorage.getItem('AGZNombre'));

        $(".navorigen").hide();
        $(".navsample").html('<div class="chatnav"><input type="text" placeholder="Mensaje..." name="Contenido" /><button id="EnviarMensaje"><span class="icon icon-check"></span></button></div>');
        $(".navsample").show();

        updateChatContent();

        ChatIntervalId = setInterval("updateChatContent()", 2000);

        $("#EnviarMensaje").on("click", function(){

            enviarmensaje();

            return false;
        });


        $('body').on("keypress", "input[name='Contenido']", function(e) {

            if (e.keyCode == 13) 
            {
                enviarmensaje();
            }
        });

    });

    function enviarmensaje()
    {
        $.ajax({
            url: 'http://agzradio.com/ws/index.php?Action=setMensaje&Nombre='+$("input[name='Nombre']").val()+'&Contenido='+$("input[name='Contenido']").val(),
            dataType: 'json',
            type: 'GET',
            async: true,
            success: function (data) {

                if(data == true)
                {
                    $("#chatcontent").prepend('<div class="containerbox"><b>'+$("input[name='Nombre']").val()+':</b> '+$("input[name='Contenido']").val()+'</div>');
                    $("input[name='Contenido']").val("");
                }

            },
            error: function (data) {
                alert("La secci칩n no est치 disponible.");
            }
        });

        return false;
    }

    function updateChatContent()
    {
        $.ajax({
            url: 'http://agzradio.com/ws/index.php?Action=getMensajes&Nombre='+$("input[name='Nombre']").val()+'&LastId='+$("input[name='LastIdChat']").val(),
            dataType: 'json',
            type: 'GET',
            async: true,
            success: function (data) {

                $.each(data, function( i, item ) {

                    if(i == 0)
                    {
                        $("input[name='LastIdChat']").val(item.id);
                    }

                    $("#chatcontent").prepend('<div class="containerbox"><b>'+item.nombre+':</b> '+item.contenido+'</div>');
                });;

            },
            error: function (data) {
                alert("La secci칩n no est치 disponible.");
            }
        });

        return false;
    }
</script>       